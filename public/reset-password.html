<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nueva Contraseña | Fast Food App</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* Estilos específicos para página de reset - complementan styles.css */
        body.reset-password-page {
            background: linear-gradient(-45deg, #FDFBFB, #EBEDEE, #FFEBEE, #FFFFFF) !important;
            background-size: 400% 400% !important;
            animation: gradientBG 20s ease infinite !important;
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            min-height: 100vh !important;
            padding: 20px !important;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
    </style>
</head>
<body class="reset-password-page">

    <div class="reset-container">
        <div class="reset-card">
            
            <div class="header">
                <div class="icon-circle">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    </svg>
                </div>
                <h1 class="reset-title">Nueva Contraseña</h1>
                <p class="subtitle reset-subtitle">Ingresa una contraseña segura para tu cuenta.</p>
            </div>

            <form id="resetForm">
                
                <div class="form-group">
                    <label for="password">Contraseña</label>
                    <div class="input-wrapper">
                        <svg class="input-icon-left" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                        
                        <input type="password" id="password" name="password" required minlength="6" placeholder="Mín. 6 caracteres">
                        
                        <div class="input-icon-right" onclick="togglePassword('password', this)">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                        </div>
                    </div>
                    <div class="strength-indicator" id="strengthIndicator">
                        <div class="strength-bar"></div>
                        <div class="strength-bar"></div>
                        <div class="strength-bar"></div>
                        <div class="strength-bar"></div>
                    </div>
                    <div class="strength-text" id="strengthText"></div>
                </div>

                <div class="form-group">
                    <label for="confirmPassword">Confirmar Contraseña</label>
                    <div class="input-wrapper">
                        <svg class="input-icon-left" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                        
                        <input type="password" id="confirmPassword" name="confirmPassword" required minlength="6" placeholder="Repite la contraseña">
                        
                        <div class="input-icon-right" onclick="togglePassword('confirmPassword', this)">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                        </div>
                    </div>
                    <div class="match-indicator" id="matchIndicator">
                        <div class="match-dot"></div>
                        <span class="match-text" id="matchText">Las contraseñas no coinciden</span>
                    </div>
                </div>

                <div id="error" class="message-box error"></div>
                <div id="success" class="message-box success"></div>

                <button type="submit" id="submitBtn" class="btn" disabled>
                    <span id="btnText">Verificando enlace...</span>
                    <span id="btnLoader" class="loader" style="display: none;"></span>
                </button>

            </form>

            <div class="footer reset-footer">
                <a href="#" onclick="window.close(); return false;">Cancelar operación</a>
            </div>

        </div>
    </div>

    <script src="app.js"></script>
    <script>
        const passwordInput = document.getElementById('password');
        const confirmInput = document.getElementById('confirmPassword');
        const submitBtn = document.getElementById('submitBtn');
        const strengthIndicator = document.getElementById('strengthIndicator');
        const strengthText = document.getElementById('strengthText');
        const matchIndicator = document.getElementById('matchIndicator');
        const matchText = document.getElementById('matchText');

        // Función para evaluar la fortaleza de la contraseña
        function evaluatePasswordStrength(password) {
            let strength = 0;
            
            if (password.length >= 6) strength++;
            if (password.length >= 10) strength++;
            if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
            if (/\d/.test(password)) strength++;
            if (/[@$!%*?&]/.test(password)) strength++;

            return strength;
        }

        // Función para obtener el texto de fortaleza
        function getStrengthText(strength) {
            if (strength === 0) return 'Muy débil';
            if (strength === 1) return 'Débil';
            if (strength === 2) return 'Regular';
            if (strength === 3) return 'Buena';
            if (strength >= 4) return 'Muy fuerte';
        }

        // Función para obtener la clase de fortaleza
        function getStrengthClass(strength) {
            if (strength === 0) return '';
            if (strength === 1) return 'strength-weak';
            if (strength === 2) return 'strength-fair';
            if (strength === 3) return 'strength-good';
            if (strength >= 4) return 'strength-strong';
        }

        // Evento para evaluar fortaleza de contraseña
        passwordInput.addEventListener('input', function() {
            const password = this.value;
            
            if (password.length > 0) {
                const strength = evaluatePasswordStrength(password);
                const strengthClass = getStrengthClass(strength);
                const strengthLabel = getStrengthText(strength);
                
                strengthIndicator.classList.add('active');
                strengthIndicator.className = 'strength-indicator active ' + strengthClass;
                strengthText.textContent = strengthLabel;
                
                // Validar input visualmente
                if (strength >= 3) {
                    this.classList.add('valid');
                    this.classList.remove('invalid');
                } else if (strength >= 1) {
                    this.classList.remove('valid', 'invalid');
                } else {
                    this.classList.remove('valid');
                    this.classList.add('invalid');
                }
            } else {
                strengthIndicator.classList.remove('active');
                this.classList.remove('valid', 'invalid');
            }

            checkPasswordMatch();
            validateForm();
        });

        // Función para verificar coincidencia de contraseñas
        function checkPasswordMatch() {
            if (confirmInput.value.length > 0) {
                matchIndicator.classList.add('active');
                if (passwordInput.value === confirmInput.value && passwordInput.value.length > 0) {
                    matchIndicator.classList.add('match');
                    matchIndicator.classList.remove('no-match');
                    matchText.textContent = '✓ Las contraseñas coinciden';
                    confirmInput.classList.add('valid');
                    confirmInput.classList.remove('invalid');
                } else {
                    matchIndicator.classList.remove('match');
                    matchIndicator.classList.add('no-match');
                    matchText.textContent = '✗ Las contraseñas no coinciden';
                    confirmInput.classList.add('invalid');
                    confirmInput.classList.remove('valid');
                }
            } else {
                matchIndicator.classList.remove('active');
                confirmInput.classList.remove('valid', 'invalid');
            }
        }

        // Evento para verificar coincidencia al escribir en confirmPassword
        confirmInput.addEventListener('input', checkPasswordMatch);

        // Función para validar el formulario
        function validateForm() {
            const passwordStrength = evaluatePasswordStrength(passwordInput.value);
            const passwordsMatch = passwordInput.value === confirmInput.value && passwordInput.value.length > 0;
            
            submitBtn.disabled = !(passwordStrength >= 3 && passwordsMatch);
        }

        // Función extra para mostrar/ocultar contraseña (UX)
        function togglePassword(inputId, iconEl) {
            const input = document.getElementById(inputId);
            
            if (input.type === "password") {
                input.type = "text";
                iconEl.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07-2.3 2.3"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>';
            } else {
                input.type = "password";
                iconEl.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>';
            }
        }
    </script>

</body>
</html>